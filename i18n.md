# Internationalization (i18n) Implementation Plan

## Overview
This document outlines the implementation of internationalization for the Laravel Homeschool Hub SaaS application, starting with English and Russian languages.

## Architecture Decision

### Chosen Approach: User Preference-Based with JSON Files
- **No route-based localization** (not `/en/dashboard` or `/ru/dashboard`)
- **User preference stored in database** (`users.locale` column)
- **JSON translation files** for easy management and scalability
- **Middleware-based locale detection**
- **Cache-friendly for performance**

## Implementation Steps

### Step 1: Database Setup
Add locale preference to users table:
```sql
ALTER TABLE users ADD COLUMN locale VARCHAR(5) DEFAULT 'en';
ALTER TABLE users ADD COLUMN timezone VARCHAR(50) DEFAULT 'UTC';
ALTER TABLE users ADD COLUMN date_format VARCHAR(20) DEFAULT 'Y-m-d';
```

### Step 2: Language File Structure
```
lang/
├── en.json         # English translations
├── ru.json         # Russian translations
├── es.json         # Future: Spanish
├── fr.json         # Future: French
└── validation/     # Validation messages
    ├── en.php
    └── ru.php
```

### Step 3: Middleware Configuration
Create `app/Http/Middleware/SetLocale.php`:
- Check authenticated user's locale preference
- Fall back to session locale for guests
- Default to browser detection or app default

### Step 4: Translation Key Convention
Use descriptive English phrases as keys:
```json
{
  "Welcome back": "Welcome back",
  "Manage Children": "Manage Children",
  "Planning Board": "Planning Board",
  "Week of :date": "Week of :date",
  "Add Child": "Add Child",
  "Save Changes": "Save Changes"
}
```

### Step 5: Blade Template Updates
Replace hardcoded strings:
```blade
<!-- Before -->
<h2>Parent Dashboard</h2>

<!-- After -->
<h2>{{ __('Parent Dashboard') }}</h2>
```

### Step 6: JavaScript/HTMX Integration
Expose translations to frontend:
```blade
<script>
window.translations = @json(__('*'));
window.locale = '{{ app()->getLocale() }}';
</script>
```

### Step 7: Language Switcher Component
Add to navigation:
```blade
<select id="language-switcher" class="...">
    <option value="en" {{ app()->getLocale() == 'en' ? 'selected' : '' }}>English</option>
    <option value="ru" {{ app()->getLocale() == 'ru' ? 'selected' : '' }}>Русский</option>
</select>
```

### Step 8: API Endpoint for Switching
```php
Route::post('/api/user/locale', [LocaleController::class, 'update']);
```

## Translation Coverage

### Phase 1: Core UI Elements
- Navigation labels
- Button texts
- Form labels
- Page titles
- Common actions (Save, Cancel, Delete, Edit)

### Phase 2: Feature-Specific
- Dashboard content
- Children management
- Subject/Unit/Topic labels
- Review system
- Calendar/scheduling
- Planning board

### Phase 3: Messages & Notifications
- Success messages
- Error messages
- Validation messages
- Email templates
- System notifications

## Database Content Translation

For user-generated content that needs translation:
```php
// Migration for translatable content
Schema::table('subjects', function ($table) {
    $table->string('name_ru')->nullable();
    $table->text('description_ru')->nullable();
});

// Model accessor
public function getNameAttribute()
{
    $locale = app()->getLocale();
    if ($locale !== 'en' && $this->{"name_$locale"}) {
        return $this->{"name_$locale"};
    }
    return $this->attributes['name'];
}
```

## Performance Optimization

### Caching Strategy
```php
// Cache translations per locale
Cache::rememberForever("translations.$locale", function () use ($locale) {
    return json_decode(file_get_contents(lang_path("$locale.json")), true);
});
```

### Clear cache on translation update
```php
Artisan::call('cache:clear', ['--tags' => 'translations']);
```

## Testing Strategy

1. **Unit Tests**: Test translation helper functions
2. **Feature Tests**: Test locale switching API
3. **E2E Tests**: Test language switcher UI
4. **Manual Testing**: Verify all UI elements in both languages

## Adding New Languages

1. Copy `lang/en.json` to `lang/[new-locale].json`
2. Translate all values
3. Add locale to `config/app.php` available_locales
4. Add locale option to language switcher
5. Test thoroughly

## Common Russian Translations

```json
{
  "Dashboard": "Панель управления",
  "Children": "Дети",
  "Subjects": "Предметы",
  "Planning": "Планирование",
  "Reviews": "Повторение",
  "Calendar": "Календарь",
  "Settings": "Настройки",
  "Logout": "Выйти",
  "Save": "Сохранить",
  "Cancel": "Отмена",
  "Delete": "Удалить",
  "Edit": "Редактировать",
  "Add": "Добавить",
  "Search": "Поиск",
  "Filter": "Фильтр",
  "Export": "Экспорт",
  "Import": "Импорт",
  "Today": "Сегодня",
  "This Week": "Эта неделя",
  "This Month": "Этот месяц",
  "Yes": "Да",
  "No": "Нет"
}
```

## Success Metrics

- All UI text is translatable (no hardcoded strings)
- Language switch is instant (<100ms)
- User preference persists across sessions
- New languages can be added in <1 hour
- Translation coverage >95% for core features
- Tests pass in all supported languages

## Maintenance

- Regular translation reviews quarterly
- Community translations via GitHub
- Professional translation service for new features
- Automated translation key detection in CI/CD