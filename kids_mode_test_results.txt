
   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeAuditLogTest::it_can_log_security_events(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeAuditLogTest::it_handles_null_values_gracefully(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeAuditLogTest::it_handles_database_errors_without_failing(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeAuditLogTest::it_can_retrieve_user_audit_logs(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeAuditLogTest::it_can_count_recent_failed_attempts(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeAuditLogTest::it_can_count_failed_attempts_by_ip(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeAuditLogTest::it_handles_query_errors_gracefully(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeAuditLogTest::it_validates_time_ranges_for_failed_attempts(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeAuditLogTest::it_properly_encodes_metadata(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeSecurityHeadersTest::it_applies_security_headers_when_kids_mode_is_active(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeSecurityHeadersTest::it_does_not_apply_security_headers_when_kids_mode_is_inactive(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeSecurityHeadersTest::it_applies_restrictive_csp_policy(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeSecurityHeadersTest::it_applies_restrictive_permissions_policy(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeSecurityHeadersTest::it_disables_caching_for_sensitive_pages(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeSecurityHeadersTest::it_does_not_disable_caching_for_non_sensitive_pages(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeSecurityHeadersTest::it_does_not_set_hsts_header_on_http(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeSecurityHeadersTest::it_identifies_sensitive_kids_mode_pages_correctly(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeSecurityHeadersTest::it_builds_csp_with_proper_syntax(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Unit\KidsModeSecurityHeadersTest::it_builds_permissions_policy_with_proper_syntax(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::parent_dashboard_shows_pin_status_and_enter_kids_mode_buttons(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::parent_dashboard_shows_set_pin_first_when_pin_not_set(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::can_enter_kids_mode_when_pin_is_set(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::cannot_enter_kids_mode_for_non_existent_child(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::cannot_enter_kids_mode_for_other_users_child(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::kids_mode_enter_returns_json_for_ajax_requests(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::kids_mode_indicator_shows_when_active(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::kids_mode_indicator_hidden_when_not_active(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::navigation_is_restricted_in_kids_mode(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::can_exit_kids_mode_with_valid_pin(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::cannot_exit_kids_mode_with_invalid_pin(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::pin_exit_screen_shows_correct_content(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::cannot_access_parent_only_routes_in_kids_mode(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeEnterExitTest::can_access_allowed_routes_in_kids_mode(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_can_complete_full_kids_mode_workflow(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_enforces_rate_limiting_on_pin_attempts(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_validates_session_fingerprinting(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_applies_security_headers_in_kids_mode(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_blocks_unauthorized_routes_in_kids_mode(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_allows_safe_routes_in_kids_mode(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_logs_security_events_properly(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_handles_pin_reset_correctly(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_validates_pin_format_correctly(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_handles_session_state_transitions_correctly(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeIntegrationTest::it_provides_proper_error_messages(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_displays_pin_settings_page_correctly_when_no_pin_is_set(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_displays_pin_settings_page_correctly_when_pin_is_set(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_can_set_new_pin_with_valid_data(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_validates_pin_format_correctly(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_validates_pin_confirmation_match(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_can_reset_existing_pin(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_displays_exit_screen_correctly_when_no_pin_is_set(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_displays_exit_screen_with_pin_entry_when_pin_is_set(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_displays_lockout_message_when_account_is_locked(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_shows_attempts_remaining_when_there_are_failed_attempts(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_redirects_when_kids_mode_is_not_active_on_exit_screen(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_validates_pin_submission_format(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_requires_authentication_for_pin_operations(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::it_blocks_pin_settings_access_when_in_kids_mode(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::pin_settings_form_includes_required_elements(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModePinUITest::exit_screen_includes_required_elements_when_pin_is_set(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_logs_kids_mode_entry_with_security_details(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_validates_session_fingerprint_on_pin_validation(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_blocks_request_with_invalid_session_fingerprint(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_implements_progressive_lockout_for_failed_pin_attempts(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_implements_ip_based_rate_limiting(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_applies_security_headers_in_kids_mode(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_does_not_apply_security_headers_when_not_in_kids_mode(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_tracks_audit_logs_for_security_events(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_clears_rate_limiting_on_successful_pin_validation(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_prevents_access_when_not_in_kids_mode(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   WARN  Metadata found in doc-comment for method Tests\Feature\KidsModeSecurityTest::it_validates_pin_format(). Metadata in doc-comments is deprecated and will no longer be supported in PHPUnit 12. Update your test code to use attributes instead.

   FAIL  Tests\Unit\KidsModeAuditLogTest
  ⨯ it can log security events                                           0.28s  
  ⨯ it handles null values gracefully                                    0.01s  
  ⨯ it handles database errors without failing                           0.01s  
  ⨯ it can retrieve user audit logs                                      0.01s  
  ⨯ it can count recent failed attempts                                  0.01s  
  ⨯ it can count failed attempts by ip                                   0.01s  
  ⨯ it handles query errors gracefully                                   0.01s  
  ⨯ it validates time ranges for failed attempts                         0.01s  
  ⨯ it properly encodes metadata                                         0.01s  

   PASS  Tests\Unit\KidsModeMiddlewareUnitTest
  ✓ kids mode middleware passes when not active                          0.07s  
  ✓ kids mode middleware allows child today route                        0.02s  
  ✓ kids mode middleware allows exit routes                              0.01s  
  ✓ kids mode middleware blocks dashboard parent                         0.01s  
  ✓ kids mode middleware blocks planning routes                          0.01s  
  ✓ kids mode middleware blocks children routes                          0.01s  
  ✓ kids mode middleware blocks create routes                            0.01s  
  ✓ kids mode middleware allows static assets                            0.01s  
  ✓ kids mode middleware allows api routes                               0.01s  
  ✓ kids mode middleware handles htmx requests                           0.01s  
  ✓ not in kids mode middleware passes when not active                   0.01s  
  ✓ not in kids mode middleware blocks when active                       0.01s  
  ✓ not in kids mode middleware handles htmx when blocked                0.01s  

   PASS  Tests\Unit\KidsModeSecurityHeadersTest
  ✓ it applies security headers when kids mode is active                 0.08s  
  ✓ it does not apply security headers when kids mode is inactive        0.01s  
  ✓ it applies restrictive csp policy                                    0.01s  
  ✓ it applies restrictive permissions policy                            0.01s  
  ✓ it disables caching for sensitive pages                              0.01s  
  ✓ it does not disable caching for non sensitive pages                  0.01s  
  ✓ it does not set hsts header on http                                  0.01s  
  ✓ it identifies sensitive kids mode pages correctly                    0.01s  
  ✓ it builds csp with proper syntax                                     0.01s  
  ✓ it builds permissions policy with proper syntax                      0.01s  

   PASS  Tests\Unit\KidsModeSecurityTest
  ✓ example                                                              0.06s  

   PASS  Tests\Feature\KidsModeControllerTest
  ✓ enter kids mode validates child ownership                            0.02s  
  ✓ session data is properly managed                                     0.01s  
  ✓ pin validation rules                                                 0.08s  
  ✓ exit pin validation rules                                            0.02s  
  ✓ kids mode requires active session                                    0.01s  
  ✓ authentication middleware is applied                                 0.06s  
  ✓ password hashing works correctly                                     0.77s  
  ✓ rate limiting key format                                             0.01s  
  ✓ pin security requirements                                            0.01s  
  ✓ lockout time calculation                                             0.01s  
  ✓ controller dependencies are injected                                 0.01s  
  ✓ routes are properly defined                                          0.06s  

   FAIL  Tests\Feature\KidsModeEnterExitTest
  ⨯ parent dashboard shows pin status and enter kids mode buttons
  ⨯ parent dashboard shows set pin first when pin not set
  ⨯ can enter kids mode when pin is set
  ⨯ cannot enter kids mode for non existent child
  ⨯ cannot enter kids mode for other users child
  ⨯ kids mode enter returns json for ajax requests
  ⨯ kids mode indicator shows when active
  ⨯ kids mode indicator hidden when not active
  ⨯ navigation is restricted in kids mode
  ⨯ can exit kids mode with valid pin
  ⨯ cannot exit kids mode with invalid pin
  ⨯ pin exit screen shows correct content
  ⨯ cannot access parent only routes in kids mode
  ⨯ can access allowed routes in kids mode

   FAIL  Tests\Feature\KidsModeIntegrationTest
  ✓ it can complete full kids mode workflow                              0.28s  
  ⨯ it enforces rate limiting on pin attempts                            0.28s  
  ✓ it validates session fingerprinting                                  0.02s  
  ✓ it applies security headers in kids mode                             0.02s  
  ✓ it blocks unauthorized routes in kids mode                           0.03s  
  ⨯ it allows safe routes in kids mode                                   0.02s  
  ⨯ it logs security events properly                                     0.03s  
  ✓ it handles pin reset correctly                                       0.27s  
  ✓ it validates pin format correctly                                    0.29s  
  ✓ it handles session state transitions correctly                       0.03s  
  ⨯ it provides proper error messages                                    0.02s  

   FAIL  Tests\Feature\KidsModeMiddlewareTest
  ✓ kids mode middleware allows access when not in kids mode             0.01s  
  ✓ kids mode middleware allows child today view                         0.01s  
  ✓ kids mode middleware allows kids mode exit routes                    0.01s  
  ⨯ kids mode middleware blocks parent only routes                       0.01s  
  ⨯ kids mode middleware handles htmx requests                           0.01s  
  ✓ kids mode middleware allows static assets                            0.01s  
  ✓ kids mode middleware allows api routes                               0.01s  
  ✓ not in kids mode middleware allows access when not in kids mode      0.01s  
  ✓ not in kids mode middleware blocks access when in kids mode          0.01s  
  ✓ not in kids mode middleware handles htmx requests when blocked       0.01s  
  ⨯ kids mode middleware blocks routes with action keywords              0.01s  
  ✓ kids mode middleware allows review completion                        0.01s  
  ⨯ kids mode middleware blocks specific parent routes                   0.01s  
  ✓ middleware logs access attempts                                      0.01s  
  ✓ middleware works without kids mode session                           0.01s  

   PASS  Tests\Feature\KidsModePinMigrationTest
  ✓ kids mode pin migration adds required fields                         0.11s  
  ✓ kids mode pin fields have correct properties                         0.03s  
  ✓ can insert kids mode pin data                                        0.03s  
  ✓ kids mode pin fields can be null                                     0.03s  
  ✓ kids mode pin attempts defaults to zero                              0.02s  
  ✓ can manage kids mode pin fields                                      0.03s  
  ✓ pin validation workflow                                              0.28s  

   PASS  Tests\Feature\KidsModePinUISimpleTest
  ✓ pin settings route is accessible                                     0.02s  
  ✓ pin settings requires authentication                                 0.02s  
  ✓ kids mode settings link appears in navigation                        0.04s  
  ✓ pin update validates pin format                                      0.01s  
  ✓ pin update validates pin confirmation match                          0.02s  
  ✓ pin update requires 4 digit pin                                      0.01s  
  ✓ exit screen requires kids mode active                                0.01s  
  ✓ exit pin validation requires kids mode active                        0.01s  
  ✓ exit pin validation validates pin format                             0.02s  
  ✓ exit pin validation requires 4 digits                                0.01s  
  ✓ pin settings blocked in kids mode                                    0.01s  
  ✓ pin update blocked in kids mode                                      0.01s  
  ✓ pin reset blocked in kids mode                                       0.01s  
  ✓ all required translations exist                                      0.01s  
  ✓ routes exist and are named correctly                                 0.01s  

   FAIL  Tests\Feature\KidsModePinUITest
  ⨯ it displays pin settings page correctly when no pin is set           0.28s  
  ⨯ it displays pin settings page correctly when pin is set              0.12s  
  ⨯ it can set new pin with valid data                                   0.10s  
  ✓ it validates pin format correctly                                    0.01s  
  ✓ it validates pin confirmation match                                  0.01s  
  ⨯ it can reset existing pin                                            0.10s  
  ⨯ it displays exit screen correctly when no pin is set                 0.01s  
  ⨯ it displays exit screen with pin entry when pin is set               0.01s  
  ⨯ it displays lockout message when account is locked                   0.01s  
  ⨯ it shows attempts remaining when there are failed attempts           0.01s  
  ✓ it redirects when kids mode is not active on exit screen             0.01s  
  ⨯ it validates pin submission format                                   0.01s  
  ⨯ it requires authentication for pin operations                        0.02s  
  ✓ it blocks pin settings access when in kids mode                      0.01s  
  ⨯ pin settings form includes required elements                         0.12s  
  ⨯ exit screen includes required elements when pin is set               0.01s  

   FAIL  Tests\Feature\KidsModeSecurityTest
  ⨯ it logs kids mode entry with security details
  ⨯ it validates session fingerprint on pin validation
  ⨯ it blocks request with invalid session fingerprint
  ⨯ it implements progressive lockout for failed pin attempts
  ⨯ it implements ip based rate limiting
  ⨯ it applies security headers in kids mode
  ⨯ it does not apply security headers when not in kids mode
  ⨯ it tracks audit logs for security events
  ⨯ it clears rate limiting on successful pin validation
  ⨯ it prevents access when not in kids mode
  ⨯ it validates pin format

   FAIL  Tests\Feature\KidsModeUITest
  ⨯ child today view renders without kids mode                           0.03s  
  ✓ kids mode session variables work                                     0.01s  
  ⨯ kids mode indicator renders when active                              0.01s  
  ✓ kids mode indicator hidden when inactive                             0.01s  
  ✓ child today view template exists                                     0.01s  
  ✓ review card partial exists                                           0.01s  
  ⨯ kids mode css classes are applied                                    0.01s  
  ⨯ regular mode css classes are applied                                 0.01s  
  ✓ kids mode javascript variables are set correctly                     0.01s  
  ✓ regular mode javascript variables are set correctly                  0.01s  
  ✓ review card renders kids mode styling                                0.01s  
  ✓ confetti animation css is included                                   0.01s  
  ✓ complex features are hidden in kids mode                             0.01s  
  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\KidsModeAuditLogTest > it can log security…   TypeError   
  Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at app/Models/KidsModeAuditLog.php:59
     55▕                 'created_at' => now()->toISOString(),
     56▕                 'updated_at' => now()->toISOString()
     57▕             ];
     58▕ 
  ➜  59▕             $supabase->from('kids_mode_audit_logs')->insert($logData);
     60▕             
     61▕             Log::info('Kids mode audit log created', [
     62▕                 'action' => $action,
     63▕                 'user_id' => $userId,

  1   app/Models/KidsModeAuditLog.php:59
  2   tests/Unit/KidsModeAuditLogTest.php:50

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\KidsModeAuditLogTest > it handles null valu…  TypeError   
  Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at app/Models/KidsModeAuditLog.php:59
     55▕                 'created_at' => now()->toISOString(),
     56▕                 'updated_at' => now()->toISOString()
     57▕             ];
     58▕ 
  ➜  59▕             $supabase->from('kids_mode_audit_logs')->insert($logData);
     60▕             
     61▕             Log::info('Kids mode audit log created', [
     62▕                 'action' => $action,
     63▕                 'user_id' => $userId,

  1   app/Models/KidsModeAuditLog.php:59
  2   tests/Unit/KidsModeAuditLogTest.php:87

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\KidsModeAuditLogTest > it handles database…   TypeError   
  Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at app/Models/KidsModeAuditLog.php:59
     55▕                 'created_at' => now()->toISOString(),
     56▕                 'updated_at' => now()->toISOString()
     57▕             ];
     58▕ 
  ➜  59▕             $supabase->from('kids_mode_audit_logs')->insert($logData);
     60▕             
     61▕             Log::info('Kids mode audit log created', [
     62▕                 'action' => $action,
     63▕                 'user_id' => $userId,

  1   app/Models/KidsModeAuditLog.php:59
  2   tests/Unit/KidsModeAuditLogTest.php:120

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\KidsModeAuditLogTest > it can retrieve user…  TypeError   
  Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at app/Models/KidsModeAuditLog.php:87
     83▕         try {
     84▕             $supabase = app(SupabaseClient::class);
     85▕             // Use system-level access for audit logs
     86▕             
  ➜  87▕             return $supabase->from('kids_mode_audit_logs')
     88▕                 ->select('*')
     89▕                 ->eq('user_id', $userId)
     90▕                 ->order('created_at', 'desc')
     91▕                 ->limit($limit)

  1   app/Models/KidsModeAuditLog.php:87
  2   tests/Unit/KidsModeAuditLogTest.php:169

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\KidsModeAuditLogTest > it can count recent…   TypeError   
  Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at app/Models/KidsModeAuditLog.php:113
    109▕             // Use system-level access for audit logs
    110▕             
    111▕             $since = Carbon::now()->subMinutes($minutes)->toISOString();
    112▕             
  ➜ 113▕             $logs = $supabase->from('kids_mode_audit_logs')
    114▕                 ->select('id')
    115▕                 ->eq('user_id', $userId)
    116▕                 ->eq('action', 'pin_failed')
    117▕                 ->gte('created_at', $since)

  1   app/Models/KidsModeAuditLog.php:113
  2   tests/Unit/KidsModeAuditLogTest.php:193

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\KidsModeAuditLogTest > it can count failed…   TypeError   
  Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at app/Models/KidsModeAuditLog.php:141
    137▕             // Use system-level access for audit logs
    138▕             
    139▕             $since = Carbon::now()->subMinutes($minutes)->toISOString();
    140▕             
  ➜ 141▕             $logs = $supabase->from('kids_mode_audit_logs')
    142▕                 ->select('id')
    143▕                 ->eq('ip_address', $ipAddress)
    144▕                 ->eq('action', 'pin_failed')
    145▕                 ->gte('created_at', $since)

  1   app/Models/KidsModeAuditLog.php:141
  2   tests/Unit/KidsModeAuditLogTest.php:215

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\KidsModeAuditLogTest > it handles query err…  TypeError   
  Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at app/Models/KidsModeAuditLog.php:87
     83▕         try {
     84▕             $supabase = app(SupabaseClient::class);
     85▕             // Use system-level access for audit logs
     86▕             
  ➜  87▕             return $supabase->from('kids_mode_audit_logs')
     88▕                 ->select('*')
     89▕                 ->eq('user_id', $userId)
     90▕                 ->order('created_at', 'desc')
     91▕                 ->limit($limit)

  1   app/Models/KidsModeAuditLog.php:87
  2   tests/Unit/KidsModeAuditLogTest.php:239

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\KidsModeAuditLogTest > it validates time ra…  TypeError   
  Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at app/Models/KidsModeAuditLog.php:113
    109▕             // Use system-level access for audit logs
    110▕             
    111▕             $since = Carbon::now()->subMinutes($minutes)->toISOString();
    112▕             
  ➜ 113▕             $logs = $supabase->from('kids_mode_audit_logs')
    114▕                 ->select('id')
    115▕                 ->eq('user_id', $userId)
    116▕                 ->eq('action', 'pin_failed')
    117▕                 ->gte('created_at', $since)

  1   app/Models/KidsModeAuditLog.php:113
  2   tests/Unit/KidsModeAuditLogTest.php:265

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Unit\KidsModeAuditLogTest > it properly encodes…   TypeError   
  Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at app/Models/KidsModeAuditLog.php:59
     55▕                 'created_at' => now()->toISOString(),
     56▕                 'updated_at' => now()->toISOString()
     57▕             ];
     58▕ 
  ➜  59▕             $supabase->from('kids_mode_audit_logs')->insert($logData);
     60▕             
     61▕             Log::info('Kids mode audit log created', [
     62▕                 'action' => $action,
     63▕                 'user_id' => $userId,

  1   app/Models/KidsModeAuditLog.php:59
  2   tests/Unit/KidsModeAuditLogTest.php:296

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > parent dash…  QueryException   
  SQLSTATE[42P07]: Duplicate table: 7 ERROR:  relation "sessions" already exists (Connection: pgsql, SQL: create table "sessions" ("id" varchar(255) not null, "user_id" bigint null, "ip_address" varchar(45) null, "user_agent" text null, "payload" text not null, "last_activity" integer not null))

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/0001_01_01_000000_create_users_table.php:30
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > parent dash…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > can enter k…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > cannot ente…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > cannot ente…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > kids mode e…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > kids mode i…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > kids mode i…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > navigation…   QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > can exit ki…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > cannot exit…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > pin exit sc…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > cannot acce…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeEnterExitTest > can access…   QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeEnterExitTest.php:23

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeIntegrationTest > it enforces rate limiting…   
  Expected response status code [422] but received 400.
Failed asserting that 400 is identical to 422.

  at tests/Feature/KidsModeIntegrationTest.php:83
     79▕             ]);
     80▕             
     81▕             // First 4 should fail with validation error, 5th should trigger lockout
     82▕             if ($i < 4) {
  ➜  83▕                 $response->assertStatus(422);
     84▕             } else {
     85▕                 $response->assertStatus(429); // Too many requests
     86▕             }
     87▕         }

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeIntegrationTest > it allows safe routes in…    
  Route /locale/translations should be accessible in kids mode
Failed asserting that 404 matches expected 200.

  at tests/Feature/KidsModeIntegrationTest.php:174
    170▕         ];
    171▕         
    172▕         foreach ($allowedRoutes as $route => $expectedStatus) {
    173▕             $response = $this->get($route);
  ➜ 174▕             $this->assertEquals($expectedStatus, $response->getStatusCode(), 
    175▕                 "Route {$route} should be accessible in kids mode");
    176▕         }
    177▕     }
    178▕

  1   tests/Feature/KidsModeIntegrationTest.php:174

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeIntegrationTest > it…  InvalidCountException   
  Method logEvent('enter', 'test-user-123', 1, '127.0.0.1', <Any>, <Any>) from Mockery_4_App_Models_KidsModeAuditLog should be called
 exactly 1 times but called 0 times.

  at tests/Feature/KidsModeIntegrationTest.php:296
    292▕ 
    293▕     protected function tearDown(): void
    294▕     {
    295▕         Session::flush();
  ➜ 296▕         parent::tearDown();
    297▕     }
    298▕ }

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeIntegrationTest > it provides proper error…    
  Expected response status code [401] but received 302.
Failed asserting that 302 is identical to 401.

  at tests/Feature/KidsModeIntegrationTest.php:289
    285▕             'pin' => '1234',
    286▕             'pin_confirmation' => '1234'
    287▕         ]);
    288▕         
  ➜ 289▕         $response->assertStatus(401);
    290▕         $response->assertJson(['error' => __('Authentication required')]);
    291▕     }
    292▕ 
    293▕     protected function tearDown(): void

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeMiddlewareTest > kids mode middleware block…   
  Expected response status code [201, 301, 302, 303, 307, 308] but received 200.
Failed asserting that false is true.

  at tests/Feature/KidsModeMiddlewareTest.php:94
     90▕         // Act: Try to access parent dashboard (matches blocked pattern)
     91▕         $response = $this->get('/dashboard/parent');
     92▕ 
     93▕         // Assert: Should redirect to child today page
  ➜  94▕         $response->assertRedirect();
     95▕         $response->assertSessionHas('error', 'Access denied in kids mode');
     96▕     }
     97▕ 
     98▕     public function test_kids_mode_middleware_handles_htmx_requests(): void

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeMiddlewareTest > kids mode middleware handl…   
  Expected response status code [403] but received 200.
Failed asserting that 200 is identical to 403.

  at tests/Feature/KidsModeMiddlewareTest.php:115
    111▕             'HX-Request' => 'true',
    112▕         ]);
    113▕ 
    114▕         // Assert: Should return JSON error with redirect header
  ➜ 115▕         $response->assertStatus(403);
    116▕         $response->assertJson([
    117▕             'error' => 'Access denied in kids mode',
    118▕         ]);
    119▕         $response->assertHeader('HX-Redirect');

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeMiddlewareTest > kids mode middleware block…   
  Expected response status code [201, 301, 302, 303, 307, 308] but received 200.
Failed asserting that false is true.

  at tests/Feature/KidsModeMiddlewareTest.php:246
    242▕         Session::put('kids_mode_active', true);
    243▕         Session::put('kids_mode_child_id', 123);
    244▕ 
    245▕         // Act & Assert: Should block routes with action keywords
  ➜ 246▕         $this->get('/test/subjects/create')->assertRedirect();
    247▕         $this->get('/test/units/123/edit')->assertRedirect();
    248▕         $this->post('/test/topics/store')->assertRedirect();
    249▕         $this->delete('/test/children/456/destroy')->assertRedirect();
    250▕     }

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeMiddlewareTest > kids mode middleware block…   
  Expected response status code [201, 301, 302, 303, 307, 308] but received 200.
Failed asserting that false is true.

  at tests/Feature/KidsModeMiddlewareTest.php:313
    309▕         Session::put('kids_mode_active', true);
    310▕         Session::put('kids_mode_child_id', 123);
    311▕ 
    312▕         // Act & Assert: Should block all these parent-only routes
  ➜ 313▕         $this->get('/test/dashboard/parent')->assertRedirect();
    314▕         $this->get('/test/children/create')->assertRedirect();
    315▕         $this->get('/test/planning/index')->assertRedirect();
    316▕         $this->get('/test/calendar/import')->assertRedirect();
    317▕         $this->get('/test/kids-mode/settings/pin')->assertRedirect();

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > it displays pin settings page c…   
  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

TypeError: Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned in /Users/leonidbugaev/go/src/learning-app/vendor/mockery/mockery/library/Mockery/Loader/EvalLoader.php(30) : eval()'d code:1059
Stack trace:
#0 /Users/leonidbugaev/go/src/learning-app/app/Http/Middleware/SetLocale.php(181): Mockery_0_App_Services_SupabaseClient->from('user_preference...')
#1 /Users/leonidbugaev/go/src/learning-app/app/Http/Middleware/SetLocale.php(32): App\Http\Middleware\SetLocale->determineLocale(Object(Illuminate\Http\Request))
#2 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): App\Http\Middleware\SetLocale->handle(Object(Illuminate\Http\Request), Object(Closure))
#3 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Middleware/SubstituteBindings.php(50): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#4 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#5 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/VerifyCsrfToken.php(87): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#6 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\VerifyCsrfToken->handle(Object(Illuminate\Http\Request), Object(Closure))
#7 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/View/Middleware/ShareErrorsFromSession.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#8 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\View\Middleware\ShareErrorsFromSession->handle(Object(Illuminate\Http\Request), Object(Closure))
#9 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Session/Middleware/StartSession.php(120): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#10 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Session/Middleware/StartSession.php(63): Illuminate\Session\Middleware\StartSession->handleStatefulRequest(Object(Illuminate\Http\Request), Object(Illuminate\Session\Store), Object(Closure))
#11 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Session\Middleware\StartSession->handle(Object(Illuminate\Http\Request), Object(Closure))
#12 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Cookie/Middleware/AddQueuedCookiesToResponse.php(36): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#13 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse->handle(Object(Illuminate\Http\Request), Object(Closure))
#14 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Cookie/Middleware/EncryptCookies.php(74): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#15 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Cookie\Middleware\EncryptCookies->handle(Object(Illuminate\Http\Request), Object(Closure))
#16 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(821): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#18 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(800): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#19 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(764): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#20 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(753): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#21 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(200): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#22 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(180): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#23 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#24 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#25 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#26 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#27 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#28 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#29 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#30 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#31 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/PreventRequestsDuringMaintenance.php(109): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#32 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#33 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/HandleCors.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#34 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#35 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#36 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#37 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#38 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#39 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/ValidatePathEncoding.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#40 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\ValidatePathEncoding->handle(Object(Illuminate\Http\Request), Object(Closure))
#41 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#42 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(175): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#43 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(144): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#44 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#45 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php(368): Illuminate\Foundation\Testing\TestCase->call('GET', 'http://localhos...', Array, Array, Array, Array)
#46 /Users/leonidbugaev/go/src/learning-app/tests/Feature/KidsModePinUITest.php(52): Illuminate\Foundation\Testing\TestCase->get('http://localhos...')
#47 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(1656): Tests\Feature\KidsModePinUITest->it_displays_pin_settings_page_correctly_when_no_pin_is_set()
#48 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(514): PHPUnit\Framework\TestCase->runTest()
#49 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestRunner/TestRunner.php(87): PHPUnit\Framework\TestCase->runBare()
#50 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(361): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\KidsModePinUITest))
#51 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestCase->run()
#52 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#53 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#54 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/TextUI/TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#55 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/TextUI/Application.php(211): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#56 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/phpunit(104): PHPUnit\TextUI\Application->run(Array)
#57 {main}

----------------------------------------------------------------------------------

Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at tests/Feature/KidsModePinUITest.php:54
     50▕         });
     51▕ 
     52▕         $response = $this->get(route('kids-mode.settings'));
     53▕ 
  ➜  54▕         $response->assertStatus(200);
     55▕         $response->assertSee(__('kids_mode_settings'));
     56▕         $response->assertSee(__('pin_not_set'));
     57▕         $response->assertSee(__('set_kids_mode_pin'));
     58▕         $response->assertDontSee(__('reset_pin'));

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > it displays pin settings page c…   
  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

TypeError: Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned in /Users/leonidbugaev/go/src/learning-app/vendor/mockery/mockery/library/Mockery/Loader/EvalLoader.php(30) : eval()'d code:1059
Stack trace:
#0 /Users/leonidbugaev/go/src/learning-app/app/Http/Middleware/SetLocale.php(181): Mockery_0_App_Services_SupabaseClient->from('user_preference...')
#1 /Users/leonidbugaev/go/src/learning-app/app/Http/Middleware/SetLocale.php(32): App\Http\Middleware\SetLocale->determineLocale(Object(Illuminate\Http\Request))
#2 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): App\Http\Middleware\SetLocale->handle(Object(Illuminate\Http\Request), Object(Closure))
#3 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Middleware/SubstituteBindings.php(50): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#4 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#5 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/VerifyCsrfToken.php(87): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#6 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\VerifyCsrfToken->handle(Object(Illuminate\Http\Request), Object(Closure))
#7 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/View/Middleware/ShareErrorsFromSession.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#8 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\View\Middleware\ShareErrorsFromSession->handle(Object(Illuminate\Http\Request), Object(Closure))
#9 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Session/Middleware/StartSession.php(120): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#10 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Session/Middleware/StartSession.php(63): Illuminate\Session\Middleware\StartSession->handleStatefulRequest(Object(Illuminate\Http\Request), Object(Illuminate\Session\Store), Object(Closure))
#11 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Session\Middleware\StartSession->handle(Object(Illuminate\Http\Request), Object(Closure))
#12 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Cookie/Middleware/AddQueuedCookiesToResponse.php(36): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#13 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse->handle(Object(Illuminate\Http\Request), Object(Closure))
#14 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Cookie/Middleware/EncryptCookies.php(74): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#15 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Cookie\Middleware\EncryptCookies->handle(Object(Illuminate\Http\Request), Object(Closure))
#16 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(821): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#18 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(800): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#19 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(764): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#20 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(753): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#21 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(200): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#22 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(180): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#23 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#24 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#25 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#26 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#27 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#28 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#29 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#30 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#31 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/PreventRequestsDuringMaintenance.php(109): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#32 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#33 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/HandleCors.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#34 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#35 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#36 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#37 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#38 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#39 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/ValidatePathEncoding.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#40 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\ValidatePathEncoding->handle(Object(Illuminate\Http\Request), Object(Closure))
#41 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#42 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(175): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#43 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(144): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#44 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#45 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php(368): Illuminate\Foundation\Testing\TestCase->call('GET', 'http://localhos...', Array, Array, Array, Array)
#46 /Users/leonidbugaev/go/src/learning-app/tests/Feature/KidsModePinUITest.php(85): Illuminate\Foundation\Testing\TestCase->get('http://localhos...')
#47 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(1656): Tests\Feature\KidsModePinUITest->it_displays_pin_settings_page_correctly_when_pin_is_set()
#48 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(514): PHPUnit\Framework\TestCase->runTest()
#49 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestRunner/TestRunner.php(87): PHPUnit\Framework\TestCase->runBare()
#50 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(361): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\KidsModePinUITest))
#51 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestCase->run()
#52 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#53 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#54 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/TextUI/TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#55 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/TextUI/Application.php(211): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#56 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/phpunit(104): PHPUnit\TextUI\Application->run(Array)
#57 {main}

----------------------------------------------------------------------------------

Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at tests/Feature/KidsModePinUITest.php:87
     83▕         });
     84▕ 
     85▕         $response = $this->get(route('kids-mode.settings'));
     86▕ 
  ➜  87▕         $response->assertStatus(200);
     88▕         $response->assertSee(__('kids_mode_settings'));
     89▕         $response->assertSee(__('pin_is_set'));
     90▕         $response->assertSee(__('update_kids_mode_pin'));
     91▕         $response->assertSee(__('reset_pin'));

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > it can set new pin with valid d…   
  Expected response status code [302] but received 500.
Failed asserting that 500 is identical to 302.

The following exception occurred during the last request:

TypeError: Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned in /Users/leonidbugaev/go/src/learning-app/vendor/mockery/mockery/library/Mockery/Loader/EvalLoader.php(30) : eval()'d code:1059
Stack trace:
#0 /Users/leonidbugaev/go/src/learning-app/app/Http/Middleware/SetLocale.php(181): Mockery_0_App_Services_SupabaseClient->from('user_preference...')
#1 /Users/leonidbugaev/go/src/learning-app/app/Http/Middleware/SetLocale.php(32): App\Http\Middleware\SetLocale->determineLocale(Object(Illuminate\Http\Request))
#2 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): App\Http\Middleware\SetLocale->handle(Object(Illuminate\Http\Request), Object(Closure))
#3 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Middleware/SubstituteBindings.php(50): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#4 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#5 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/VerifyCsrfToken.php(87): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#6 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\VerifyCsrfToken->handle(Object(Illuminate\Http\Request), Object(Closure))
#7 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/View/Middleware/ShareErrorsFromSession.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#8 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\View\Middleware\ShareErrorsFromSession->handle(Object(Illuminate\Http\Request), Object(Closure))
#9 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Session/Middleware/StartSession.php(120): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#10 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Session/Middleware/StartSession.php(63): Illuminate\Session\Middleware\StartSession->handleStatefulRequest(Object(Illuminate\Http\Request), Object(Illuminate\Session\Store), Object(Closure))
#11 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Session\Middleware\StartSession->handle(Object(Illuminate\Http\Request), Object(Closure))
#12 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Cookie/Middleware/AddQueuedCookiesToResponse.php(36): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#13 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse->handle(Object(Illuminate\Http\Request), Object(Closure))
#14 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Cookie/Middleware/EncryptCookies.php(74): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#15 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Cookie\Middleware\EncryptCookies->handle(Object(Illuminate\Http\Request), Object(Closure))
#16 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(821): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#18 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(800): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#19 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(764): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#20 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(753): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#21 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(200): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#22 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(180): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#23 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#24 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#25 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#26 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#27 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#28 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#29 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#30 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#31 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/PreventRequestsDuringMaintenance.php(109): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#32 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#33 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/HandleCors.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#34 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#35 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#36 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#37 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#38 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#39 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/ValidatePathEncoding.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#40 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\ValidatePathEncoding->handle(Object(Illuminate\Http\Request), Object(Closure))
#41 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#42 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(175): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#43 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(144): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#44 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#45 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php(397): Illuminate\Foundation\Testing\TestCase->call('POST', 'http://localhos...', Array, Array, Array, Array)
#46 /Users/leonidbugaev/go/src/learning-app/tests/Feature/KidsModePinUITest.php(123): Illuminate\Foundation\Testing\TestCase->post('http://localhos...', Array)
#47 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(1656): Tests\Feature\KidsModePinUITest->it_can_set_new_pin_with_valid_data()
#48 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(514): PHPUnit\Framework\TestCase->runTest()
#49 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestRunner/TestRunner.php(87): PHPUnit\Framework\TestCase->runBare()
#50 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(361): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\KidsModePinUITest))
#51 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestCase->run()
#52 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#53 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#54 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/TextUI/TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#55 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/TextUI/Application.php(211): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#56 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/phpunit(104): PHPUnit\TextUI\Application->run(Array)
#57 {main}

----------------------------------------------------------------------------------

Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at tests/Feature/KidsModePinUITest.php:128
    124▕             'pin' => '1234',
    125▕             'pin_confirmation' => '1234',
    126▕         ]);
    127▕ 
  ➜ 128▕         $response->assertStatus(302);
    129▕         $response->assertRedirect(route('kids-mode.settings'));
    130▕         $response->assertSessionHas('success', __('Kids mode PIN has been set successfully'));
    131▕     }
    132▕

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > it can reset existing pin          
  Expected response status code [302] but received 500.
Failed asserting that 500 is identical to 302.

The following exception occurred during the last request:

TypeError: Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned in /Users/leonidbugaev/go/src/learning-app/vendor/mockery/mockery/library/Mockery/Loader/EvalLoader.php(30) : eval()'d code:1059
Stack trace:
#0 /Users/leonidbugaev/go/src/learning-app/app/Http/Middleware/SetLocale.php(181): Mockery_0_App_Services_SupabaseClient->from('user_preference...')
#1 /Users/leonidbugaev/go/src/learning-app/app/Http/Middleware/SetLocale.php(32): App\Http\Middleware\SetLocale->determineLocale(Object(Illuminate\Http\Request))
#2 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): App\Http\Middleware\SetLocale->handle(Object(Illuminate\Http\Request), Object(Closure))
#3 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Middleware/SubstituteBindings.php(50): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#4 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#5 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/VerifyCsrfToken.php(87): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#6 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\VerifyCsrfToken->handle(Object(Illuminate\Http\Request), Object(Closure))
#7 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/View/Middleware/ShareErrorsFromSession.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#8 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\View\Middleware\ShareErrorsFromSession->handle(Object(Illuminate\Http\Request), Object(Closure))
#9 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Session/Middleware/StartSession.php(120): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#10 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Session/Middleware/StartSession.php(63): Illuminate\Session\Middleware\StartSession->handleStatefulRequest(Object(Illuminate\Http\Request), Object(Illuminate\Session\Store), Object(Closure))
#11 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Session\Middleware\StartSession->handle(Object(Illuminate\Http\Request), Object(Closure))
#12 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Cookie/Middleware/AddQueuedCookiesToResponse.php(36): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#13 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse->handle(Object(Illuminate\Http\Request), Object(Closure))
#14 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Cookie/Middleware/EncryptCookies.php(74): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#15 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Cookie\Middleware\EncryptCookies->handle(Object(Illuminate\Http\Request), Object(Closure))
#16 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(821): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#18 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(800): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#19 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(764): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#20 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(753): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#21 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(200): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#22 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(180): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#23 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#24 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#25 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#26 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#27 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#28 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#29 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#30 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#31 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/PreventRequestsDuringMaintenance.php(109): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#32 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#33 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/HandleCors.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#34 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#35 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#36 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#37 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#38 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#39 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/ValidatePathEncoding.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#40 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\ValidatePathEncoding->handle(Object(Illuminate\Http\Request), Object(Closure))
#41 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#42 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(175): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#43 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(144): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#44 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#45 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php(397): Illuminate\Foundation\Testing\TestCase->call('POST', 'http://localhos...', Array, Array, Array, Array)
#46 /Users/leonidbugaev/go/src/learning-app/tests/Feature/KidsModePinUITest.php(186): Illuminate\Foundation\Testing\TestCase->post('http://localhos...')
#47 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(1656): Tests\Feature\KidsModePinUITest->it_can_reset_existing_pin()
#48 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(514): PHPUnit\Framework\TestCase->runTest()
#49 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestRunner/TestRunner.php(87): PHPUnit\Framework\TestCase->runBare()
#50 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(361): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\KidsModePinUITest))
#51 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestCase->run()
#52 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#53 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#54 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/TextUI/TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#55 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/TextUI/Application.php(211): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#56 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/phpunit(104): PHPUnit\TextUI\Application->run(Array)
#57 {main}

----------------------------------------------------------------------------------

Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at tests/Feature/KidsModePinUITest.php:188
    184▕         });
    185▕ 
    186▕         $response = $this->post(route('kids-mode.pin.reset'));
    187▕ 
  ➜ 188▕         $response->assertStatus(302);
    189▕         $response->assertRedirect(route('kids-mode.settings'));
    190▕         $response->assertSessionHas('success', __('Kids mode PIN has been reset successfully'));
    191▕     }
    192▕

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > it displays exit screen…   Error   
  Call to undefined method App\Models\Child::shouldReceive()

  at tests/Feature/KidsModePinUITest.php:205
    201▕         $this->mock(\App\Services\SupabaseClient::class, function ($mock) {
    202▕             $mock->shouldReceive('setUserToken')->once();
    203▕             
    204▕             // Mock child lookup
  ➜ 205▕             \App\Models\Child::shouldReceive('find')
    206▕                 ->with(1, \Mockery::type(\App\Services\SupabaseClient::class))
    207▕                 ->andReturn((object) [
    208▕                     'id' => 1,
    209▕                     'name' => 'Test Child',

  1   tests/Feature/KidsModePinUITest.php:205
  2   tests/Feature/KidsModePinUITest.php:201

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > it displays exit screen…   Error   
  Call to undefined method App\Models\Child::shouldReceive()

  at tests/Feature/KidsModePinUITest.php:252
    248▕         $this->mock(\App\Services\SupabaseClient::class, function ($mock) {
    249▕             $mock->shouldReceive('setUserToken')->once();
    250▕             
    251▕             // Mock child lookup
  ➜ 252▕             \App\Models\Child::shouldReceive('find')
    253▕                 ->with(1, \Mockery::type(\App\Services\SupabaseClient::class))
    254▕                 ->andReturn((object) [
    255▕                     'id' => 1,
    256▕                     'name' => 'Test Child',

  1   tests/Feature/KidsModePinUITest.php:252
  2   tests/Feature/KidsModePinUITest.php:248

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > it displays lockout mess…  Error   
  Call to undefined method App\Models\Child::shouldReceive()

  at tests/Feature/KidsModePinUITest.php:302
    298▕         $this->mock(\App\Services\SupabaseClient::class, function ($mock) use ($lockoutTime) {
    299▕             $mock->shouldReceive('setUserToken')->once();
    300▕             
    301▕             // Mock child lookup
  ➜ 302▕             \App\Models\Child::shouldReceive('find')
    303▕                 ->with(1, \Mockery::type(\App\Services\SupabaseClient::class))
    304▕                 ->andReturn((object) [
    305▕                     'id' => 1,
    306▕                     'name' => 'Test Child',

  1   tests/Feature/KidsModePinUITest.php:302
  2   tests/Feature/KidsModePinUITest.php:298

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > it shows attempts remain…  Error   
  Call to undefined method App\Models\Child::shouldReceive()

  at tests/Feature/KidsModePinUITest.php:349
    345▕         $this->mock(\App\Services\SupabaseClient::class, function ($mock) {
    346▕             $mock->shouldReceive('setUserToken')->once();
    347▕             
    348▕             // Mock child lookup
  ➜ 349▕             \App\Models\Child::shouldReceive('find')
    350▕                 ->with(1, \Mockery::type(\App\Services\SupabaseClient::class))
    351▕                 ->andReturn((object) [
    352▕                     'id' => 1,
    353▕                     'name' => 'Test Child',

  1   tests/Feature/KidsModePinUITest.php:349
  2   tests/Feature/KidsModePinUITest.php:345

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > it validates pin submission for…   
  Expected response status code [422] but received 400.
Failed asserting that 400 is identical to 422.

  at tests/Feature/KidsModePinUITest.php:406
    402▕         $response = $this->postJson(route('kids-mode.exit.validate'), [
    403▕             'pin' => '12a4', // Invalid: contains letter
    404▕         ]);
    405▕ 
  ➜ 406▕         $response->assertStatus(422);
    407▕         $response->assertJsonValidationErrors('pin');
    408▕     }
    409▕ 
    410▕     /** @test */

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > it requires authentication for…    
  Expected response status code [401] but received 302.
Failed asserting that 302 is identical to 401.

  at tests/Feature/KidsModePinUITest.php:423
    419▕         $response = $this->post(route('kids-mode.pin.update'), [
    420▕             'pin' => '1234',
    421▕             'pin_confirmation' => '1234',
    422▕         ]);
  ➜ 423▕         $response->assertStatus(401);
    424▕ 
    425▕         $response = $this->post(route('kids-mode.pin.reset'));
    426▕         $response->assertStatus(401);
    427▕     }

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > pin settings form includes requ…   
  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

TypeError: Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned in /Users/leonidbugaev/go/src/learning-app/vendor/mockery/mockery/library/Mockery/Loader/EvalLoader.php(30) : eval()'d code:1059
Stack trace:
#0 /Users/leonidbugaev/go/src/learning-app/app/Http/Middleware/SetLocale.php(181): Mockery_0_App_Services_SupabaseClient->from('user_preference...')
#1 /Users/leonidbugaev/go/src/learning-app/app/Http/Middleware/SetLocale.php(32): App\Http\Middleware\SetLocale->determineLocale(Object(Illuminate\Http\Request))
#2 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): App\Http\Middleware\SetLocale->handle(Object(Illuminate\Http\Request), Object(Closure))
#3 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Middleware/SubstituteBindings.php(50): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#4 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#5 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/VerifyCsrfToken.php(87): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#6 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\VerifyCsrfToken->handle(Object(Illuminate\Http\Request), Object(Closure))
#7 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/View/Middleware/ShareErrorsFromSession.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#8 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\View\Middleware\ShareErrorsFromSession->handle(Object(Illuminate\Http\Request), Object(Closure))
#9 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Session/Middleware/StartSession.php(120): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#10 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Session/Middleware/StartSession.php(63): Illuminate\Session\Middleware\StartSession->handleStatefulRequest(Object(Illuminate\Http\Request), Object(Illuminate\Session\Store), Object(Closure))
#11 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Session\Middleware\StartSession->handle(Object(Illuminate\Http\Request), Object(Closure))
#12 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Cookie/Middleware/AddQueuedCookiesToResponse.php(36): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#13 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse->handle(Object(Illuminate\Http\Request), Object(Closure))
#14 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Cookie/Middleware/EncryptCookies.php(74): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#15 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Cookie\Middleware\EncryptCookies->handle(Object(Illuminate\Http\Request), Object(Closure))
#16 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(821): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#18 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(800): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#19 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(764): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#20 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Routing/Router.php(753): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#21 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(200): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#22 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(180): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#23 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#24 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#25 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#26 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#27 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#28 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#29 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#30 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#31 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/PreventRequestsDuringMaintenance.php(109): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#32 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#33 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/HandleCors.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#34 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#35 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#36 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#37 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#38 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#39 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Http/Middleware/ValidatePathEncoding.php(26): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#40 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(219): Illuminate\Http\Middleware\ValidatePathEncoding->handle(Object(Illuminate\Http\Request), Object(Closure))
#41 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(137): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#42 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(175): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#43 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(144): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#44 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#45 /Users/leonidbugaev/go/src/learning-app/vendor/laravel/framework/src/Illuminate/Foundation/Testing/Concerns/MakesHttpRequests.php(368): Illuminate\Foundation\Testing\TestCase->call('GET', 'http://localhos...', Array, Array, Array, Array)
#46 /Users/leonidbugaev/go/src/learning-app/tests/Feature/KidsModePinUITest.php(462): Illuminate\Foundation\Testing\TestCase->get('http://localhos...')
#47 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(1656): Tests\Feature\KidsModePinUITest->pin_settings_form_includes_required_elements()
#48 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(514): PHPUnit\Framework\TestCase->runTest()
#49 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestRunner/TestRunner.php(87): PHPUnit\Framework\TestCase->runBare()
#50 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestCase.php(361): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\KidsModePinUITest))
#51 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestCase->run()
#52 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#53 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/Framework/TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#54 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/TextUI/TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#55 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/src/TextUI/Application.php(211): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#56 /Users/leonidbugaev/go/src/learning-app/vendor/phpunit/phpunit/phpunit(104): PHPUnit\TextUI\Application->run(Array)
#57 {main}

----------------------------------------------------------------------------------

Mockery_0_App_Services_SupabaseClient::from(): Return value must be of type App\Services\SupabaseQueryBuilder, Mockery_0_App_Services_SupabaseClient returned

  at tests/Feature/KidsModePinUITest.php:464
    460▕         });
    461▕ 
    462▕         $response = $this->get(route('kids-mode.settings'));
    463▕ 
  ➜ 464▕         $response->assertStatus(200);
    465▕         
    466▕         // Check for form elements
    467▕         $response->assertSee('name="pin"', false);
    468▕         $response->assertSee('name="pin_confirmation"', false);

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModePinUITest > exit screen includes req…  Error   
  Call to undefined method App\Models\Child::shouldReceive()

  at tests/Feature/KidsModePinUITest.php:491
    487▕         // Mock child data and PIN check
    488▕         $this->mock(\App\Services\SupabaseClient::class, function ($mock) {
    489▕             $mock->shouldReceive('setUserToken')->once();
    490▕             
  ➜ 491▕             \App\Models\Child::shouldReceive('find')
    492▕                 ->with(1, \Mockery::type(\App\Services\SupabaseClient::class))
    493▕                 ->andReturn((object) [
    494▕                     'id' => 1,
    495▕                     'name' => 'Test Child',

  1   tests/Feature/KidsModePinUITest.php:491
  2   tests/Feature/KidsModePinUITest.php:488

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it logs kids…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it validates…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it blocks re…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it implement…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it implement…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it applies s…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it does not…   QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it tracks au…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it clears ra…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it prevents…   QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeSecurityTest > it validates…  QueryException   
  SQLSTATE[42P01]: Undefined table: 7 ERROR:  relation "subjects" does not exist (Connection: pgsql, SQL: alter table "subjects" add column "child_id" integer null)

  at vendor/laravel/framework/src/Illuminate/Database/Connection.php:824
    820▕                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    821▕                 );
    822▕             }
    823▕ 
  ➜ 824▕             throw new QueryException(
    825▕                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    826▕             );
    827▕         }
    828▕     }

      [2m+10 vendor frames [22m
  11  database/migrations/2025_09_05_200528_add_child_id_to_subjects_table.php:14
      [2m+38 vendor frames [22m
  50  tests/Feature/KidsModeSecurityTest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeUITest > child today…  NotFoundHttpException   
  GET http://localhost:8000/dashboard/child-today/1

  at vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php:574
    570▕      * @return \Symfony\Component\HttpFoundation\Response
    571▕      */
    572▕     protected function renderException($request, Throwable $e)
    573▕     {
  ➜ 574▕         return $this->app[ExceptionHandler::class]->render($request, $e);
    575▕     }
    576▕ 
    577▕     /**
    578▕      * Get the application's global middleware.

      [2m+48 vendor frames [22m
  49  tests/Feature/KidsModeUITest.php:26

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeUITest > kids mode indicator renders when a…   
  Expected: <div class="fixed top-4 right-4 z-50 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg shadow-lg p-4 animate-pulse" \n
           data-testid="kids-mode-indicator">\n
          <div class="flex items-center space-x-3">\n
  ... (31 more lines)

  To contain: kids_mode_active

  at tests/Feature/KidsModeUITest.php:57
     53▕         $html = $component->render();
     54▕ 
     55▕         $this->assertStringContainsString('kids-mode-indicator', $html);
     56▕         $this->assertStringContainsString('Test Child', $html);
  ➜  57▕         $this->assertStringContainsString('kids_mode_active', $html);
     58▕     }
     59▕ 
     60▕     public function test_kids_mode_indicator_hidden_when_inactive()
     61▕     {

  1   tests/Feature/KidsModeUITest.php:57

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeUITest > kids mode css classes are applied     
  Expected: <!DOCTYPE html>\n
  <html lang="en">\n
    <head>\n
  ... (888 more lines)

  To contain: Today's Adventures!

  at tests/Feature/KidsModeUITest.php:113
    109▕ 
    110▕         // Check for kids mode styling
    111▕         $this->assertStringContainsString('bg-gradient-to-r from-pink-500', $html);
    112▕         $this->assertStringContainsString('Hello, Test Child!', $html);
  ➜ 113▕         $this->assertStringContainsString('Today\'s Adventures!', $html);
    114▕         $this->assertStringContainsString('Adventures Today', $html);
    115▕     }
    116▕ 
    117▕     public function test_regular_mode_css_classes_are_applied()

  1   tests/Feature/KidsModeUITest.php:113

  ────────────────────────────────────────────────────────────────────────────  
   FAILED  Tests\Feature\KidsModeUITest > regular mode css classes are appli…   
  Expected: <!DOCTYPE html>\n
  <html lang="en">\n
    <head>\n
  ... (816 more lines)

  To contain: Test Child's Learning Today

  at tests/Feature/KidsModeUITest.php:146
    142▕ 
    143▕         // Check for regular mode styling
    144▕         $this->assertStringContainsString('bg-gradient-to-r from-blue-500 to-purple-600', $html);
    145▕         $this->assertStringNotContainsString('Hello, Test Child!', $html);
  ➜ 146▕         $this->assertStringContainsString('Test Child\'s Learning Today', $html);
    147▕         $this->assertStringContainsString('Today\'s Sessions', $html);
    148▕     }
    149▕ 
    150▕     public function test_kids_mode_javascript_variables_are_set_correctly()

  1   tests/Feature/KidsModeUITest.php:146


  Tests:    58 failed, 89 passed (427 assertions)
  Duration: 18.64s

